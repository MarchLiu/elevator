# 设计和实现规划

## 要点分析

“电梯调度测试框架”，是电梯调度算法的测试和度量环境。

它应该是一个测试框架，可以验证调度程序的接口是否正确。

这也就意味着，测试框架应该能够提供一个虚拟环境，使算法程序可以被测试框架调用和执行。这个接口要么与实际环境保持一致，要么足够简单，使对接逻辑不至于造成不必要的复杂。

测试框架应该提供仿真能力，即
1. 对调用过程的验证和度量，与测试过程的设计在逻辑上分离，互不影响
1. 支持脚本化的场景设计
1. 支持丰富的度量表现
1. 支持一定的管理能力
1. 综合前述两点，测试框架本身应该提供GUI
1. 作为一个扩展的要求，测试框架最好能提供一定的安全能力，限制算法程序运行在沙盒程序中


## 架构和功能设计

基于前述的分析，我们设计如下的测试框架架构：

1. 测试框架的核心本身是一个Web服务，这样便于扩展，开发也比较便利
1. 测试框架通过命令行，调用docker实例运行调度程序，输入输出通过 stdin 和 stdout 传递
1. 通过 web 页，提供管理和profile
1. 所有功能提供 http json api
1. 允许设定定时或手动执行已注册的算法
1. 提供算法的提交注册功能
1. 能够度量算法的性能指标，包括但不限于：
 1. 乘客的平均等待时间
 1. 固定时间内的运量
 1. 以上指标的方差
 1. 程序本身的执行性能
1. 框架允许算法程序以无状态或有状态运行
 1. 无状态算法直接一次性的从命令行参数传入数据
 1. 有状态算法以repl形式循环的从 stdin 读取命令输入，并从 stdout 输出，如果输出一个空行，表示结束。

这个设计的要点是：
- 利用 docker 既有的功能，构建一个沙盒环境
 - docker 实例仅用于运行算法，因此可以使用充分小的镜像
 - 可以提供固定的沙盒种类，规范化算法的技术栈
 - 通过扩充沙盒种类，可以扩展测试框架的功能，对新的特定的运行时依赖提供支持
- 对于算法的开发者，仅需关注命令行交互，通过最小的开发代价实现对接。
- http 协议、json 是现代程序员非常熟悉的技术组合，得到广泛支持，足够易用
- http + json + 命令行，也是物联网项目中常用的技术组合
- 通过常规的数据库提供管理能力，简化开发
- 协议用最小开发代价实现有状态或无状态支持


## 架构设计

帮我画出一个架构图，表现如下架构：
